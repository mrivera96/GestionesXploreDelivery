<!-- CARD START -->
<div @fade class="card shadow">
  <div class="card-header" style="border-color: #0071A2;border-style: none none solid;
  border-width: 0 0 3px; ">
    <a [routerLink]="['/']"> <i class="fa fa-arrow-circle-left m-r-xs"></i></a>
    <h3 class="inline">Solicitud N° {{deliveryId}}</h3>
  </div>

  <div class="card-body" *ngIf="loaders.loadingData">
    <div class="row">
      <div class="col text-center">
        <img src="/GestionesDelivery/assets/img/loading.svg" width="35%" alt="loading">
        <p>Cargando información...</p>
      </div>
    </div>
  </div>
  <!-- CARD BODY START -->
  <div class="card-body" *ngIf="!loaders.loadingData">
    <div class="card-title">
      <h4>Datos Generales</h4>
    </div>

    <div class="row">
      <div class="col-sm">
        <strong>Nombre del cliente:</strong>
        {{currentDelivery?.nomCliente}}
      </div>
      <div class="col-sm">
        <strong>Número de identificación:</strong>
        {{currentDelivery?.numIdentificacion}}
      </div>

      <div class="col-sm">
        <strong>Número de celular:</strong>
        {{currentDelivery?.numCelular}}
      </div>
    </div>

    <div class="row">
      <div class="col-sm">
        <strong>Dirección de recogida:</strong>
        <a href="https://www.google.com/maps?q={{currentDelivery?.dirRecogida}}"> {{currentDelivery?.dirRecogida}} </a>

      </div>

      <div class="col-sm">
        <strong>Categoría reservada:</strong>
        {{currentDelivery?.category?.descTipoVehiculo}}
      </div>
      <div class="col-sm">
        <strong>Fecha y hora de recogida:</strong>
        {{currentDelivery?.fechaReserva}}
      </div>
    </div>

    <div class="row">
      <div class="col-sm">
        <strong>e-mail:</strong>
        {{currentDelivery?.email}}
      </div>
      <div class="col-sm">
        <strong>Tarifa Base:</strong>
        L. {{currentDelivery?.tarifaBase}}
      </div>


      <div class="col-sm">
        <strong>Recargos:</strong>
        L. {{currentDelivery?.recargos}}
      </div>
    </div>

    <div class="row">
      <div class="col-sm">
        <strong>Total:</strong>
        L. {{currentDelivery?.total}}
      </div>

      <div class="col-sm">
        <strong>Pagada:</strong>
        <span *ngIf="currentDelivery?.isPagada == true" class="text-success"> SI</span>
        <span *ngIf="currentDelivery?.isPagada == false" class="text-danger"> NO</span>
      </div>

      <div class="col-sm">
        <strong>Estado Actual:</strong>
        {{currentDelivery?.estado.descEstado}}
      </div>


    </div>

    <div class="row">
      <div class="col-sm" *ngIf="currentDelivery.idEstado == 37">
        <strong>Asignada a:</strong>
        {{currentDelivery?.detalle[0]?.conductor.nomUsuario}}
      </div>


    </div>
    <br>
    <div class="row">
      <div class="col-sm">
        <button type="button" class="btn btn-sm btn-outline-info" data-toggle="modal" data-target="#changeModal">
          Cambiar Estado
        </button>
      </div>
    </div>

    <br>
    <div>
      <h4 class="card-title">Entregas programadas</h4>
    </div>

    <div class="table-responsive">
      <table class="table table-striped table-hover display" datatable [dtOptions]="dtOptions" style="width: 100%">

        <thead>
        <tr>
          <th>Detalle de entrega</th>
          <th data-priority="1">Nombre de destinatario</th>
          <th data-priority="1">Número de teléfono</th>
          <th>Dirección de entrega</th>
          <th>Distancia</th>
        </tr>

        </thead>

        <tbody>
        <tr *ngFor="let detail of currentDeliveryDetail; let i = index">
          <td>{{detail.nFactura}}</td>
          <td>{{detail.nomDestinatario}}</td>
          <td>{{detail.numCel}}</td>
          <td>
            <a href="https://www.google.com/maps?q={{detail.direccion}}"> {{detail.direccion}} </a>
          </td>
          <td>{{detail.distancia}}</td>
        </tr>
        </tbody>
      </table>
    </div>


  </div>
  <!-- CARD BODY END -->
</div>
<!-- CARD END -->

<!-- MODAL START -->
<div id="asignModal" class="modal fade" tabindex="-1" role="dialog">
  <div class="modal-dialog modal-dialog-centered" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h3 class="modal-title text-primary">Asignar Reserva</h3>
      </div>
      <div class="modal-body">
        <form [formGroup]="asignForm">
          <div class="form-group">
            <label class="col-form-label" for="idConductor">Conductor:</label>
            <select class="form-control" name="idConductor" id="idConductor" formControlName="idConductor"
                    [class.is-invalid]=" asignForm.get('idConductor').invalid && asignForm.get('idConductor').touched">
              <option [value]="null">-Seleccione un conductor-</option>
              <option *ngFor="let conductor of conductores" value="{{conductor.idUsuario}}">
                {{conductor.nomUsuario}}
              </option>
            </select>
            <small
              *ngIf="asignForm.get('idConductor').errors?.required &&  asignForm.get('idConductor').touched"
              class="text-danger">*Este campo es obligatorio</small>
          </div>
          <!-- <div class="form-group">
             <label class="col-form-label" for="idVehiculo">Vehículo:</label>
             <select class="form-control" name="idVehiculo" id="idVehiculo" formControlName="idVehiculo"
                     [class.is-invalid]=" asignForm.get('idVehiculo').invalid && asignForm.get('idVehiculo').touched">
               <option [value]="null">-Seleccione un vehículo-</option>
               <option *ngFor="let vehicle of vehicles" value="{{vehicle.idVehiculo}}">
                 {{vehicle.nemVehiculo + ' ' + vehicle.modelo}}
               </option>
             </select>
             <small
               *ngIf="asignForm.get('idVehiculo').errors?.required &&  asignForm.get('idVehiculo').touched"
               class="text-danger">*Este campo es obligatorio</small>
           </div>-->

        </form>
      </div>
      <div class="modal-footer">
        <button type="button" [disabled]="asignForm.invalid" (click)="assignDelivery()" class="btn btn-sm btn-rounded btn-outline-primary"
                data-dismiss="modal">Asignar
        </button>
        <button type="button" class="btn  btn-outline-secondary btn-sm btn-rounded" data-dismiss="modal">Cancelar</button>
      </div>
    </div>
  </div>
</div>
<!-- MODAL END -->


<!-- MODAL START -->
<div id="errModal" class="modal fade" tabindex="-1" role="dialog">
  <div class="modal-dialog modal-dialog-centered" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h3 class="modal-title text-danger">Ha ocurrido un error</h3>
      </div>
      <div class="modal-body">
        <p>{{errorMSg}}</p>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-outline-danger btn-sm btn-rounded" data-dismiss="modal">Aceptar</button>
      </div>
    </div>
  </div>
</div>
<!-- MODAL END -->

<!-- MODAL START -->
<div id="succsModal" class="modal fade" tabindex="-1" role="dialog">
  <div class="modal-dialog modal-dialog-centered" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h3 class="modal-title text-success">{{succsTitle}}</h3>
      </div>
      <div class="modal-body">
        <p>{{succsMsg}}</p>
      </div>
      <div class="modal-footer">
        <button type="button" (click)="reloadPage()" class="btn btn-sm btn-rounded btn-outline-primary" data-dismiss="modal">Aceptar
        </button>
      </div>
    </div>
  </div>
</div>
<!-- MODAL END -->

<!-- MODAL START -->
<div id="confirmModal" class="modal fade" tabindex="-1" role="dialog">
  <div class="modal-dialog modal-dialog-centered" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h3 class="modal-title text-warning">Finalizar reserva</h3>
      </div>
      <div class="modal-body">
        <p>¿Está seguro de finalizar esta reserva?</p>
      </div>
      <div class="modal-footer">
        <button type="button" (click)="finishDelivery()" class="btn btn-sm btn-rounded btn-outline-primary" data-dismiss="modal">Aceptar
        </button>
        <button type="button" class="btn btn-sm btn-rounded btn-outline-secondary" data-dismiss="modal">Cancelar</button>

      </div>
    </div>
  </div>
</div>
<!-- MODAL END -->


<!-- MODAL START -->
<div id="changeModal" class="modal fade" tabindex="-1" role="dialog">
  <div class="modal-dialog modal-dialog-centered" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h3 class="modal-title text-info">Cambiar Estado de Reserva</h3>
      </div>
      <div class="modal-body">
        <form [formGroup]="changeForm">
          <div class="form-group">
            <label class="col-form-label" for="idEstado">Estado:</label>
            <select class="form-control" name="idEstado" id="idEstado" formControlName="idEstado"
                    [class.is-invalid]=" changeForm.get('idEstado').invalid && changeForm.get('idEstado').touched">
              <option [value]="null">-Seleccione un estado-</option>
              <option *ngFor="let estado of states" value="{{estado.idEstado}}">
                {{estado.descEstado}}
              </option>
            </select>
            <small
              *ngIf="changeForm.get('idEstado').errors?.required &&  changeForm.get('idEstado').touched"
              class="text-danger">*Este campo es obligatorio</small>
          </div>


        </form>
      </div>
      <div class="modal-footer">
        <button type="button" [disabled]="changeForm.invalid" (click)="changeState()" class="btn btn-sm btn-outline-primary btn-rounded"
                data-dismiss="modal">Cambiar
        </button>
        <button type="button" class="btn btn-sm btn-rounded btn-outline-secondary" data-dismiss="modal">Cancelar</button>
      </div>
    </div>
  </div>
</div>
<!-- MODAL END -->

